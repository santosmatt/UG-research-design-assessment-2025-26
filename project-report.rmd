---
title: "Group project assessment"
author: 'B229565'
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

NOTE: Please don't edit this template directly. Use `File` > `Save as` to create a copy of this document, rename it (remove the word "template" from the file name) and use that new version to write your report. Make sure to also update the Title and Author fields in the YAML of your .Rmd file.

## Library
```{r}
needed_pkgs <- c("tidyverse", "here")
for (pkg in needed_pkgs) {
if (!require(pkg, character.only = TRUE)) {
install.packages(pkg)
library(pkg, character.only = TRUE)
} else {
library(pkg, character.only = TRUE)
}}
```

## Task 1: Reproducing and improving figures

```{r importing-required-packages}
needed_pkgs <- c("tidyverse", "here", "pacman","magrittr","dplyr") #Put your needed package here

for (pkg in needed_pkgs) {
  if (!require(pkg, character.only = TRUE)) {
    install.packages(pkg)
    library(pkg, character.only = TRUE)
  } else {
    library(pkg, character.only = TRUE)
  }
}

```


```{r load-wrangle}
# load and wrangle the data here

postpartum_depression_data_raw <- 
  readr::read_csv(here::here("data", "HIIT-postpartum-depression.csv")) %>% 
  janitor::clean_names()

postpartum_depression_data <- postpartum_depression_data_raw %>% 
  select(intervention_group, 
         edinburg_postnatal_depression_scale_score, 
         pre_fs_scale,
         post_fs_score,
         postnatal_florishing_scale_score,
         pre_sf_12_pcs_physicalhealthscale,
         post_sf12_pcs,
         postpre_sf12_pcs
         ) %>% 
  mutate(postnatal_depression_score = 
           as.numeric(edinburg_postnatal_depression_scale_score) %>% 
           cut(breaks = c(0,9,12,30), 
               labels = c("range indicating the norm (below 10 points)",
                      "slightly increased severity PDD symptoms (10-11 points)",
                      "increased severity of PDD symptoms"),
               include.lowest = TRUE))

```

### Figure 3 Reproduction
```{r figure-3}
# A quick check how many bad EPDS values are "NULL"
hiit_ppd_raw %>% 
  count(`Edinburg Postnatal Depression Scale Score` == "#NULL!") # bad epds NULL

# Fig 3 Data wrangling
fig3_raw <- hiit_ppd_raw %>%
  mutate(
    group = case_when(
      `Intervention group` == 1 ~ "HIIT",
      `Intervention group` == 2 ~ "EDU",
      TRUE ~ NA_character_
    ),
    epds = `Edinburg Postnatal Depression Scale Score` %>%
      na_if("#NULL!") %>%
      as.numeric(),
    post_bdi2 = `POST depression BDI-II score` %>%
      na_if("#NULL!") %>%
      as.numeric()
  ) %>%
  filter(!is.na(group), !is.na(epds), !is.na(post_bdi2)) %>%  # ensures HIIT=34, EDU=19
  mutate(
    epds_cat = case_when(
      epds < 10  ~ "<10",
      epds <= 11 ~ "10-11",
      TRUE       ~ "≥12"
    ),
    epds_cat = factor(epds_cat, levels = c("<10", "10-11", "≥12")),
    group = factor(group, levels = c("HIIT", "EDU"))
  )

# Summarise for stacked proportions
fig3_sum <- fig3_raw %>%
  count(group, epds_cat, name = "n") %>%
  group_by(group) %>%
  mutate(
    pct = n / sum(n),
    label = paste0(round(pct * 100, 1), "%")
  ) %>%
  ungroup()

fig3_sum %>% group_by(group) %>% summarise(total = sum(n), .groups = "drop") #sanity check


# Figure Plot (Original)
ggplot(fig3_sum, aes(x = group, y = pct, fill = epds_cat)) +
  geom_col(width = 0.25, position = position_stack(reverse = TRUE)) +
  coord_flip() +
  scale_y_continuous(
    limits = c(0, 1),
    breaks = seq(0, 1, 0.1),
    labels = scales::percent_format(accuracy = 0.01)
  ) +
  scale_fill_manual(
    values = c("<10" = "#8DB6F8",
               "10-11" = "#083B92",
               "≥12"  = "#C32113"),
    labels = c(
      "<10" = "range indicating the norm (below 10 points)",
      "10-11" = "slightly increased severity of PPD symptoms (10–11 points)",
      "≥12" = "increased severity of PPD symptoms (12 or more points)"
    )
  ) +
  scale_x_discrete(
    labels = c(
      "HIIT" = "HIIT – High Intensity Interval Training Group",
      "EDU"  = "EDU – Educational Intervention Group"
    )
  ) +
  labs(x = NULL, y = NULL, fill = NULL) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )
```

### Figure 3 Improvement (75 words)
The original Figure 3 is a 100% stacked bar chart, which makes it hard to compare the HIIT and EDU groups within each EPDS category because differences must be visually estimated from segment lengths. We improved readability by switching to a grouped bar chart (side-by-side bars for HIIT vs EDU in each category), allowing direct group comparisons for each cut-off band. We also added percentage labels to remove ambiguity and reduce reliance on visual approximation.
```{r}
fig3_sum_imp <- fig3_raw %>%
  count(group, epds_cat, name = "n") %>%
  group_by(group) %>%
  mutate(pct = n / sum(n) * 100) %>%
  ungroup()

# group totals for legend labels
group_totals <- fig3_sum_imp %>%
  group_by(group) %>%
  summarise(total = sum(n), .groups = "drop")

# 2) Improved Plot
ggplot(fig3_sum_imp, aes(x = epds_cat, y = pct, fill = group)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(
    aes(label = paste0(round(pct, 1), "%")),
    position = position_dodge(width = 0.8),
    vjust = -0.5,
    size = 3
  ) +
  scale_fill_manual(
    values = c("HIIT" = "#0072B2", "EDU" = "#D55E00"),
    breaks = c("HIIT", "EDU"),
    labels = paste0(group_totals$group, " (n=", group_totals$total, ")")
  ) +
  scale_x_discrete(
    labels = c(
      "<10"   = "<10 (No depression)",
      "10-11" = "10–11 (Borderline)",
      "≥12"   = "≥12 (Elevated)"
    )
  ) +
  scale_y_continuous(
    limits = c(0, 100),
    breaks = seq(0, 100, 10),
    expand = expansion(mult = c(0, 0.10))
  ) +
  labs(
    x = "Postpartum EPDS category",
    y = "Participants (%)",
    fill = "Group"
  ) +
  theme_classic(base_size = 12) +
  theme(
    legend.position = "top"
  )
```


### Figure 4
```{r figure-4}
# Write your code for reproducing, and then improving Figure 4. Present both figures together. Under the figures, explain how you've improved Figure 4 and why you consider this an improvement.
```


### Figure 5
```{r figure-5}
# Write your code for reproducing, and then improving Figure 5. Present both figures together. Under the figures, explain how you've improved Figure 5 and why you consider this an improvement.
```


## Task 2: FAIR data principles

## Task 3: Reproducibility brief
